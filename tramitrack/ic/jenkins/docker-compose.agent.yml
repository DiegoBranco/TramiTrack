version: '3.8'
services:
  jenkins-agent:
    build:
      context: ./agent
      dockerfile: Dockerfile
      args:
        - DOCKER_GID=${DOCKER_GID}
    image: tramitrack/jenkins-agent-docker
    restart: unless-stopped
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - jenkins_agent_home:/home/jenkins
    environment:
      - JENKINS_URL=http://jenkins:8080
    # If you run on systems where 'jenkins' needs root for entrypoint actions,
    # you can set `user: root` here. Prefer avoiding it in production.

volumes:
  jenkins_agent_home:
